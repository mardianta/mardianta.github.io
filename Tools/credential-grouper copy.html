<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title id="pageTitle">Pengelompok Data Kredensial</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #f4f4f9;
            color: #333;
            line-height: 1.6;
        }
        .container {
            max-width: 1000px;
            margin: auto;
            background-color: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 20px;
        }
        textarea {
            width: calc(100% - 22px);
            height: 200px;
            margin-bottom: 15px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
        }
        .controls {
            text-align: center;
            margin-bottom: 25px;
        }
        .controls button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 18px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.95em;
            transition: background-color 0.3s ease;
        }
        .controls button:hover {
            background-color: #2980b9;
        }
        .group {
            margin-bottom: 25px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            padding: 15px;
            background-color: #fdfdfd;
        }
        .group h3 {
            margin-top: 0;
            color: #2980b9;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
            word-break: break-all;
        }
        .group ul {
            list-style-type: none;
            padding-left: 0;
        }
        .group li, #output > div > div { /* Style for ungrouped items too */
            background-color: #f9f9f9;
            border: 1px solid #eee;
            padding: 8px 12px;
            margin-bottom: 6px;
            border-radius: 3px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.85em;
            word-break: break-all;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .group li .details, #output > div > div .details {
            font-size: 0.9em;
            color: #555;
        }
        .group li .original-line, #output > div > div .original-line {
             flex-grow: 1;
        }
        .error-message {
            color: red;
            font-style: italic;
            font-size: 0.9em;
        }
        .count {
            font-weight: normal;
            font-size: 0.8em;
            color: #777;
        }
        .parsed-info {
            font-size: 0.8em;
            color: #007bff;
            margin-left: 10px;
            white-space: pre-wrap;
            background-color: #e9f5ff;
            padding: 3px 6px;
            border-radius: 3px;
            border: 1px dashed #b3d7ff;
            min-width: 200px;
        }
        .partial-remove-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }
        .partial-remove-controls input {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .partial-remove-controls button {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 12px 18px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.95em;
            transition: background-color 0.3s ease;
        }
        
        .preset-remove-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
            align-items: center;
            padding: 10px;
            background-color: #f9f9f9;
            border: 1px solid #eee;
            border-radius: 4px;
        }
        .preset-remove-controls span {
            font-weight: bold;
            color: #555;
            margin-right: 10px;
        }
        .preset-remove-controls button {
            background-color: #c0392b;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.3s ease;
        }
        .preset-remove-controls button:hover {
            background-color: #a93226;
        }
        .parsed-info.hidden {
            display: none;
        }
        #groupButtonsContainer {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        .group-selector-button {
            background-color: #5cb85c;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.3s ease;
        }
        .group-selector-button:hover {
            background-color: #4cae4c;
        }
        .group li, #output > div > div {
            cursor: pointer;
        }
        .language-switcher {
            text-align: center;
            margin-bottom: 20px;
        }
        .language-switcher button {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 8px 12px;
            margin: 0 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.3s ease;
        }
        .language-switcher button:hover {
            background-color: #5a6268;
        }
        .language-switcher button.active {
            background-color: #007bff;
        }
        .copy-button, .check-button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 18px;
            margin-top: 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.95em;
            transition: background-color 0.3s ease;
        }
        .check-button { background-color: #1abc9c; margin-left: 10px; }
        .copy-button:hover:not(:disabled), .check-button:hover:not(:disabled) {
            background-color: #2980b9;
        }
        .check-button:hover:not(:disabled) { background-color: #16a085; }
        .copy-button:disabled { background-color: #28a745; cursor: default; }
        .check-button:disabled { background-color: #f39c12; cursor: wait; }
        
        /* Gaya untuk fitur URL Unik */
        #uniqueUrlOutput {
            margin-top: 15px;
            padding: 15px;
            border: 1px solid #3498db;
            border-radius: 4px;
            background-color: #ecf0f1;
            display: none; /* Sembunyikan secara default */
            text-align: center;
        }
        #uniqueUrlOutput.visible {
            display: block;
        }
        #uniqueUrlTextarea {
            width: calc(100% - 22px);
            height: 150px;
            margin-bottom: 10px;
            resize: vertical;
        }
        .unique-url-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }
        .unique-url-controls button {
             background-color: #007bff;
             color: white;
             border: none;
             padding: 10px 15px;
             border-radius: 4px;
             cursor: pointer;
             font-size: 0.9em;
             transition: background-color 0.3s ease;
        }
        .unique-url-controls button:hover {
            background-color: #0056b3;
        }
        .unique-url-controls button:disabled {
            background-color: #6c757d;
            cursor: default;
        }
        /* Akhir Gaya untuk fitur URL Unik */

        /* Gaya untuk daftar domain interaktif */
        #domainListContainer {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            max-height: 300px;
            overflow-y: auto;
            background-color: #fff;
        }
        .domain-list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            border-bottom: 1px solid #f0f0f0;
            font-family: 'Courier New', Courier, monospace;
        }
        .domain-list-item:last-child { border-bottom: none; }
        .domain-status {
            font-weight: bold;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            min-width: 80px;
            text-align: center;
        }
        .status-ok { background-color: #d4edda; color: #155724; }
        .status-error { background-color: #f8d7da; color: #721c24; }
        .status-checking { background-color: #fff3cd; color: #856404; }
        .status-unchecked { background-color: #e2e3e5; color: #383d41; }
        
    </style>
</head>
<body onload="initializePage()">
    <div class="container">
        <div class="language-switcher">
            <button id="btnLangId" onclick="setLanguage('id')">Bahasa Indonesia</button>
            <button id="btnLangEn" onclick="setLanguage('en')">English</button>
        </div>
        <h1 id="mainHeader">Pengelompok Data Kredensial</h1>
        <p id="appDescription">Salin dan tempel data dari file teks Anda ke dalam area teks di bawah ini. Setiap baris data diharapkan dalam format <code>url:username:password</code> atau <code>username:password::url</code>.</p>
        <textarea id="dataInput" placeholder="Contoh: domain.com/login:pengguna123:sandiRahasia ATAU pengguna@email.com:sandiEmail::domain.com/login"></textarea>
        
        <div class="partial-remove-controls">
            <input type="text" id="partialTextToRemove" placeholder="Ketik teks yang ingin dihapus dari setiap baris">
            <button id="btnRemovePartial" onclick="removePartialText()">Hapus Teks Parsial</button>
        </div>

        <div class="preset-remove-controls">
            <span id="presetRemoveLabel">Hapus Cepat:</span>
            <button id="btnRemoveHttps" onclick="removePredefinedText('https://')">Hapus 'https://'</button>
            <button id="btnRemoveHttp" onclick="removePredefinedText('http://')">Hapus 'http://'</button>
            <button id="btnRemoveWww" onclick="removePredefinedText('www.')">Hapus 'www.'</button>
            <button id="btnRemove8Spaces" onclick="removePredefinedText('            &quot;lineContent&quot;: &quot;')">Hapus 8 Spasi</button>
        </div>
        
        <div class="controls">
            <button id="btnGroupByUrl" onclick="processAndGroup('url')">Kelompokkan berdasarkan URL</button>
            <button id="btnGroupByUsername" onclick="processAndGroup('username')">Kelompokkan berdasarkan Username</button>
            <button id="btnGroupByPassword" onclick="processAndGroup('password')">Kelompokkan berdasarkan Password</button>
            <button id="btnGroupByDomain" onclick="processAndGroup('domain')">Kelompokkan berdasarkan Domain</button>
            <button id="btnRemoveDuplicates" onclick="removeDuplicateLinesFromTextarea()">Hapus Duplikat dari Textarea</button>
            <button id="btnSortTextarea" onclick="sortTextarea()">Urutkan Textarea</button>
            <button id="btnShowAllParsed" onclick="showAllParsed()">Tampilkan Semua (Diparsing)</button>
        </div>

        <div id="uniqueUrlOutput">
            <h3 id="uniqueUrlTitle">Daftar URL Unik</h3>
            <textarea id="uniqueUrlTextarea" readonly placeholder="URL unik akan muncul di sini."></textarea>
            <div class="unique-url-controls">
                <button id="btnCopyUniqueUrls" onclick="copyUniqueUrls()">Salin Semua URL Unik</button>
            </div>
        </div>
        <div id="output">
            <p id="resultsPlaceholder">Hasil pengelompokan akan ditampilkan di sini.</p>
        </div>
    </div>
    
    <script>
        let parsedEntriesGlobal = [];
        let currentLanguage = 'id';
        window.lastAction = null;
        window.lastGroupKey = null;
        
        const translations = {
            id: {
                pageTitle: "Pengelompok Data Kredensial",
                mainHeader: "Pengelompok Data Kredensial",
                appDescription: "Salin dan tempel data dari file teks Anda ke dalam area teks di bawah ini. Setiap baris data diharapkan dalam format <code>url:username:password</code> atau <code>username:password::url</code>.",
                textareaPlaceholder: "Contoh: domain.com/login:pengguna123:sandiRahasia ATAU pengguna@email.com:sandiEmail::domain.com/login",
                btnGroupByUrl: "Kelompokkan berdasarkan URL",
                btnGroupByUsername: "Kelompokkan berdasarkan Username",
                btnGroupByPassword: "Kelompokkan berdasarkan Password",
                btnGroupByDomain: "Kelompokkan berdasarkan Domain",
                btnRemoveDuplicates: "Hapus Duplikat dari Textarea",
                btnRemovePartial: "Hapus Teks Parsial",
                partialTextPlaceholder: "Ketik teks yang ingin dihapus dari setiap baris",
                btnSortTextarea: "Urutkan Textarea",
                btnShowAllParsed: "Tampilkan Semua (Diparsing)",
                resultsPlaceholder: "Hasil pengelompokan akan ditampilkan di sini.",
                presetRemoveLabel: "Hapus Cepat:",
                btnRemoveHttps: "Hapus 'https://'",
                btnRemoveHttp: "Hapus 'http://'",
                btnRemoveWww: "Hapus 'www.'",
                btnRemove8Spaces: "Hapus 8 Spasi",
                errorInvalidEmptyUrl: "URL Tidak Valid/Kosong",
                errorEmptyUrl: "URL Kosong",
                errorNonStandardUrlFormat: "Format URL Tidak Standar",
                errorEmptyHostname: "Hostname Kosong",
                errorDomainNotExtractable: "Domain Tidak Dapat Diekstrak",
                errorFormatColonPasswordDoubleColonUrl: "Format :password::url tidak standar, username diasumsikan kosong.",
                errorFormatUserPassEndsColonDoubleColonUrl: (p) => `Format ${p}::url (username diakhiri :) tidak standar, password diasumsikan kosong.`,
                errorFormat2PartUrlUser: "Format 2 bagian, diasumsikan url:username (password kosong).",
                errorFormat2PartUserPass: "Format 2 bagian, diasumsikan username:password (URL kosong).",
                errorFormat1Part: (type) => `Format 1 bagian, diasumsikan sebagai ${type === 'username' ? translations.id.keyNameUsername : translations.id.keyNameUrl} (lainnya kosong).`,
                errorNotEnoughParts: "Baris tidak memiliki cukup bagian untuk diparsing.",
                errorTextareaEmpty: "Area teks kosong. Silakan masukkan data.",
                errorPartialTextEmpty: "Silakan masukkan teks yang ingin dihapus.",
                groupKeyCannotParse: "Tidak Dapat Diparsing/Error",
                groupKeyEmptyKeyData: "Data Kunci Kosong",
                statusNoDataToDisplay: "Tidak ada data untuk ditampilkan atau dikelompokkan.",
                entriesSuffix: "entri",
                parsedInfoLabelUrl: "URL",
                parsedInfoLabelUser: "User",
                parsedInfoLabelPass: "Pass",
                parsedInfoLabelInfo: "Info Parsing",
                emptyPlaceholder: "[kosong]",
                statusNoDataParsed: "Tidak ada data yang berhasil diparsing. Periksa format input.",
                showAllTitle: "Semua Entri (Diparsing)",
                keyNameUrl: "URL",
                keyNameUsername: "Username",
                keyNamePassword: "Password",
                keyNameDomain: "Domain",
                statusTextareaEmptyNoDuplicates: "Textarea kosong, tidak ada duplikat untuk dihapus.",
                statusDuplicatesRemoved: (orig, uniq) => `Proses hapus duplikat selesai. Jumlah baris asli (tidak kosong): ${orig}. Jumlah baris unik (termasuk baris kosong signifikan): ${uniq}.`,
                specialGroupKeyError: "Tidak Dapat Diparsing/Error",
                specialGroupKeyInvalidUrl: "URL Tidak Valid/Kosong",
                specialGroupKeyEmptyUrl: "URL Kosong",
                specialGroupKeyNonStandardUrl: "Format URL Tidak Standar",
                specialGroupKeyEmptyHostname: "Hostname Kosong",
                specialGroupKeyDomainNotExtractable: "Domain Tidak Dapat Diekstrak",
                specialGroupKeyEmptyData: "Data Kunci Kosong",
                uniqueUrlTitle: "Daftar URL Unik", // BARU
                uniqueUrlPlaceholder: "URL unik akan muncul di sini.", // BARU
                btnCopyUniqueUrls: "Salin Semua URL Unik", // BARU
                copySuccess: "URL Unik Berhasil Disalin!", // BARU
                domainListTitle: "Daftar Domain",
                activeDomainListTitle: (count) => `Daftar Domain Aktif (${count})`,
                copyDomainListButton: "Salin Daftar Domain",
                copyDomainListButtonSuccess: "Tersalin!",
                checkDomainStatusButton: "Cek Status Domain",
                checkingDomainStatusButton: "Mengecek...",
                statusUnchecked: "Belum dicek",
                statusChecking: "Mengecek",
                statusOK: "Aktif",
                statusError: "Gagal",
                errorCopyFailed: "Gagal menyalin. Silakan salin secara manual.",
            },
            en: {
                pageTitle: "Credential Data Grouper",
                mainHeader: "Credential Data Grouper",
                appDescription: "Copy and paste data from your text file into the text area below. Each line of data is expected in the format <code>url:username:password</code> or <code>username:password::url</code>.",
                textareaPlaceholder: "Example: domain.com/login:user123:secretPassword OR user@email.com:emailPassword::domain.com/login",
                btnGroupByUrl: "Group by URL",
                btnGroupByUsername: "Group by Username",
                btnGroupByPassword: "Group by Password",
                btnGroupByDomain: "Group by Domain",
                btnRemoveDuplicates: "Remove Duplicates from Textarea",
                btnRemovePartial: "Remove Partial Text",
                partialTextPlaceholder: "Type text to remove from each line",
                btnSortTextarea: "Sort Textarea",
                btnShowAllParsed: "Show All (Parsed)",
                resultsPlaceholder: "Grouping results will be displayed here.",
                presetRemoveLabel: "Quick Remove:",
                btnRemoveHttps: "Remove 'https://'",
                btnRemoveHttp: "Remove 'http://'",
                btnRemoveWww: "Remove 'www.'",
                btnRemove8Spaces: "Remove 8 Spaces",
                errorInvalidEmptyUrl: "Invalid/Empty URL",
                errorEmptyUrl: "Empty URL",
                errorNonStandardUrlFormat: "Non-Standard URL Format",
                errorEmptyHostname: "Empty Hostname",
                errorDomainNotExtractable: "Domain Cannot Be Extracted",
                errorFormatColonPasswordDoubleColonUrl: "Format :password::url is non-standard, username assumed empty.",
                errorFormatUserPassEndsColonDoubleColonUrl: (p) => `Format ${p}::url (username ends with :) is non-standard, password assumed empty.`,
                errorFormat2PartUrlUser: "2-part format, assumed url:username (password empty).",
                errorFormat2PartUserPass: "2-part format, assumed username:password (URL empty).",
                errorFormat1Part: (type) => `1-part format, assumed as ${type === 'username' ? translations.en.keyNameUsername : translations.en.keyNameUrl} (others empty).`,
                errorNotEnoughParts: "Line does not have enough parts to parse.",
                errorTextareaEmpty: "Text area is empty. Please enter data.",
                errorPartialTextEmpty: "Please enter the text you want to remove.",
                groupKeyCannotParse: "Cannot Be Parsed/Error",
                groupKeyEmptyKeyData: "Empty Key Data",
                statusNoDataToDisplay: "No data to display or group.",
                entriesSuffix: "entries",
                parsedInfoLabelUrl: "URL",
                parsedInfoLabelUser: "User",
                parsedInfoLabelPass: "Pass",
                parsedInfoLabelInfo: "Parsing Info",
                emptyPlaceholder: "[empty]",
                statusNoDataParsed: "No data was successfully parsed. Check the input format.",
                showAllTitle: "All Entries (Parsed)",
                keyNameUrl: "URL",
                keyNameUsername: "Username",
                keyNamePassword: "Password",
                keyNameDomain: "Domain",
                statusTextareaEmptyNoDuplicates: "Textarea is empty, no duplicates to remove.",
                statusDuplicatesRemoved: (orig, uniq) => `Duplicate removal process finished. Original non-empty line count: ${orig}. Unique line count (including significant empty lines): ${uniq}.`,
                specialGroupKeyError: "Cannot Be Parsed/Error",
                specialGroupKeyInvalidUrl: "Invalid/Empty URL",
                specialGroupKeyEmptyUrl: "Empty URL",
                specialGroupKeyNonStandardUrl: "Non-Standard URL Format",
                specialGroupKeyEmptyHostname: "Empty Hostname",
                specialGroupKeyDomainNotExtractable: "Domain Cannot Be Extracted",
                specialGroupKeyEmptyData: "Empty Key Data",
                uniqueUrlTitle: "Unique URL List", // BARU
                uniqueUrlPlaceholder: "Unique URLs will appear here.", // BARU
                btnCopyUniqueUrls: "Copy All Unique URLs", // BARU
                copySuccess: "Unique URLs Copied Successfully!", // BARU
                domainListTitle: "Domain List",
                activeDomainListTitle: (count) => `Active Domain List (${count})`,
                copyDomainListButton: "Copy Domain List",
                copyDomainListButtonSuccess: "Copied!",
                checkDomainStatusButton: "Check Domain Status",
                checkingDomainStatusButton: "Checking...",
                statusUnchecked: "Unchecked",
                statusChecking: "Checking",
                statusOK: "Active",
                statusError: "Failed",
                errorCopyFailed: "Failed to copy. Please copy manually.",
            }
        };
        
        function T(key, ...args) {
            const langPack = translations[currentLanguage];
            if (!langPack || typeof langPack[key] === 'undefined') {
                const fallbackLangPack = translations['id'];
                if (fallbackLangPack && typeof fallbackLangPack[key] !== 'undefined') {
                    const fallbackString = fallbackLangPack[key];
                    return typeof fallbackString === 'function' ? fallbackString(...args) : fallbackString;
                }
                return key;
            }
            const stringOrFn = langPack[key];
            return typeof stringOrFn === 'function' ? stringOrFn(...args) : stringOrFn;
        }

        function updateUIText() {
            document.getElementById('pageTitle').textContent = T('pageTitle');
            document.getElementById('mainHeader').textContent = T('mainHeader');
            document.getElementById('appDescription').innerHTML = T('appDescription');
            document.getElementById('dataInput').placeholder = T('textareaPlaceholder');
            document.getElementById('btnGroupByUrl').textContent = T('btnGroupByUrl');
            document.getElementById('btnGroupByUsername').textContent = T('btnGroupByUsername');
            document.getElementById('btnGroupByPassword').textContent = T('btnGroupByPassword');
            document.getElementById('btnGroupByDomain').textContent = T('btnGroupByDomain');
            document.getElementById('btnRemoveDuplicates').textContent = T('btnRemoveDuplicates');
            document.getElementById('btnRemovePartial').textContent = T('btnRemovePartial');
            document.getElementById('partialTextToRemove').placeholder = T('partialTextPlaceholder');
            document.getElementById('btnSortTextarea').textContent = T('btnSortTextarea');
            document.getElementById('btnShowAllParsed').textContent = T('btnShowAllParsed');
            document.getElementById('presetRemoveLabel').textContent = T('presetRemoveLabel');
            document.getElementById('btnRemoveHttps').textContent = T('btnRemoveHttps');
            document.getElementById('btnRemoveHttp').textContent = T('btnRemoveHttp');
            document.getElementById('btnRemoveWww').textContent = T('btnRemoveWww');
            document.getElementById('btnRemove8Spaces').textContent = T('btnRemove8Spaces');
            document.getElementById('btnLangId').classList.toggle('active', currentLanguage === 'id');
            document.getElementById('btnLangEn').classList.toggle('active', currentLanguage === 'en');
            
            // BARU: Update teks untuk fitur URL Unik
            document.getElementById('uniqueUrlTitle').textContent = T('uniqueUrlTitle');
            document.getElementById('uniqueUrlTextarea').placeholder = T('uniqueUrlPlaceholder');
            document.getElementById('btnCopyUniqueUrls').textContent = T('btnCopyUniqueUrls');

            const outputDiv = document.getElementById('output');
            const resultsPlaceholderP = outputDiv.querySelector('p#resultsPlaceholder');
            if (resultsPlaceholderP || outputDiv.innerHTML.includes(translations.id.resultsPlaceholder) || outputDiv.innerHTML.includes(translations.en.resultsPlaceholder)) {
                outputDiv.innerHTML = `<p id="resultsPlaceholder">${T('resultsPlaceholder')}</p>`;
            }
        }
        
        function setLanguage(lang) {
            currentLanguage = lang;
            updateUIText();
            // Panggil ulang render untuk memastikan teks di output juga diperbarui
            if (window.lastAction) {
                if (window.lastAction === 'group') {
                    processAndGroup(window.lastGroupKey);
                } else if (window.lastAction === 'showAll') {
                    showAllParsed();
                }
            } else {
                document.getElementById('output').innerHTML = `<p id="resultsPlaceholder">${T('resultsPlaceholder')}</p>`;
            }
        }
        
        function initializePage() {
            setLanguage('id'); // Set default language to Indonesian
            // Sembunyikan output URL Unik saat inisialisasi
            document.getElementById('uniqueUrlOutput').classList.remove('visible');
        }

        // --- FUNGSI PARSING & GRUPING (Inti) ---

        function parseLine(line) {
            const parts = line.split(/::|:/).map(p => p.trim());
            
            let url = '';
            let username = '';
            let password = '';
            let info = '';

            const isDoubleColonPresent = line.includes('::');

            if (isDoubleColonPresent) {
                // Format: user:pass::url
                if (parts.length >= 3) {
                    username = parts[0];
                    password = parts[1];
                    url = parts.slice(2).join('::'); // Ambil sisa setelah '::' sebagai URL
                } else if (parts.length === 2) {
                    // Kasus khusus, mungkin ada user::url atau :pass::url
                    if (line.startsWith('::')) {
                        // ::url
                        url = parts[1];
                        username = '';
                        password = '';
                        info = T('errorFormat1Part', 'url');
                    } else if (line.indexOf('::') === parts[0].length) {
                        // user::url (password kosong)
                        username = parts[0];
                        url = parts[1];
                        password = '';
                        info = T('errorFormat2PartUrlUser'); // Menggunakan pesan yang sama, meskipun urutannya berbeda
                    } else if (line.indexOf('::') > 0) {
                        // user:pass::url, tapi salah parsing
                        return { original: line, error: T('errorNotEnoughParts') };
                    }
                } else {
                     return { original: line, error: T('errorNotEnoughParts') };
                }
                
                // Cek kasus khusus ":password::url"
                if (username === '' && password !== '' && url !== '') {
                    info = T('errorFormatColonPasswordDoubleColonUrl');
                }

            } else {
                // Format: url:user:pass atau url:user
                if (parts.length >= 3) {
                    url = parts[0];
                    username = parts[1];
                    password = parts[2];
                } else if (parts.length === 2) {
                    // Bisa jadi url:user (pass kosong) atau user:pass (url kosong)
                    const potentialUrl = parts[0].toLowerCase();
                    if (potentialUrl.includes('.') || potentialUrl.includes('/') || potentialUrl.startsWith('http')) {
                        // Diasumsikan url:user
                        url = parts[0];
                        username = parts[1];
                        password = '';
                        info = T('errorFormat2PartUrlUser');
                    } else {
                        // Diasumsikan user:pass
                        username = parts[0];
                        password = parts[1];
                        url = '';
                        info = T('errorFormat2PartUserPass');
                    }
                } else if (parts.length === 1 && parts[0] !== '') {
                    // Hanya 1 bagian, diasumsikan url atau username
                    const potentialUrl = parts[0].toLowerCase();
                    if (potentialUrl.includes('.') || potentialUrl.includes('/') || potentialUrl.startsWith('http')) {
                        url = parts[0];
                        info = T('errorFormat1Part', 'url');
                    } else {
                        username = parts[0];
                        info = T('errorFormat1Part', 'username');
                    }
                } else {
                    return { original: line, error: T('errorNotEnoughParts') };
                }
            }

            // Normalisasi URL dan Ekstraksi Domain
            let domain = '';
            let normalizedUrl = url;
            let urlParsingError = '';

            if (normalizedUrl) {
                try {
                    // Coba parse sebagai URL lengkap
                    let tempUrl = normalizedUrl;
                    if (!tempUrl.startsWith('http')) {
                        tempUrl = 'http://' + tempUrl;
                    }
                    const urlObj = new URL(tempUrl);
                    
                    // Ambil hostname dan hapus 'www.' (optional, tapi membantu pengelompokan)
                    let hostname = urlObj.hostname.replace(/^www\./i, '');
                    if (hostname) {
                        // Normalisasi URL menjadi hanya skema + hostname + path
                        normalizedUrl = `${urlObj.protocol}//${urlObj.hostname}${urlObj.pathname}`;
                        if (urlObj.search) normalizedUrl += urlObj.search;
                        if (urlObj.hash) normalizedUrl += urlObj.hash;

                        // Ekstraksi domain (hanya root domain)
                        const parts = hostname.split('.');
                        if (parts.length >= 2) {
                            domain = parts.slice(-2).join('.');
                        } else {
                            domain = hostname;
                            if (domain.includes('/')) {
                                domain = domain.substring(0, domain.indexOf('/'));
                            }
                        }
                    } else {
                        urlParsingError = T('errorEmptyHostname');
                    }
                } catch (e) {
                    urlParsingError = T('errorNonStandardUrlFormat');
                    // Coba lagi dengan asumsi itu domain/url tanpa protokol
                    normalizedUrl = url;
                    
                    try {
                        let potentialDomain = normalizedUrl.split('/')[0];
                        potentialDomain = potentialDomain.replace(/^www\./i, '');
                        if (potentialDomain.includes('.')) {
                             const parts = potentialDomain.split('.');
                            if (parts.length >= 2) {
                                domain = parts.slice(-2).join('.');
                            } else {
                                domain = potentialDomain;
                            }
                        } else {
                            urlParsingError = T('errorDomainNotExtractable');
                        }
                    } catch (e2) {
                        urlParsingError = T('errorDomainNotExtractable');
                    }
                }
            } else {
                urlParsingError = T('errorEmptyUrl');
            }
            
            if (urlParsingError) {
                if (info) {
                    info += `\n(${urlParsingError})`;
                } else {
                    info = urlParsingError;
                }
            }

            return {
                original: line,
                url: url.trim() || T('emptyPlaceholder'),
                username: username.trim() || T('emptyPlaceholder'),
                password: password.trim() || T('emptyPlaceholder'),
                domain: domain || T('emptyPlaceholder'),
                normalizedUrl: normalizedUrl.trim() || T('emptyPlaceholder'),
                info: info || T('emptyPlaceholder')
            };
        }

        function processAndGroup(key) {
            const input = document.getElementById('dataInput').value.trim();
            const outputDiv = document.getElementById('output');
            const uniqueUrlOutput = document.getElementById('uniqueUrlOutput');
            outputDiv.innerHTML = '';
            
            // Sembunyikan output URL Unik kecuali jika key adalah 'url'
            uniqueUrlOutput.classList.remove('visible');

            if (!input) {
                outputDiv.innerHTML = `<p class="error-message">${T('errorTextareaEmpty')}</p>`;
                window.lastAction = null;
                return;
            }

            const lines = input.split('\n').filter(line => line.trim() !== '');
            parsedEntriesGlobal = lines.map(line => parseLine(line));

            const validEntries = parsedEntriesGlobal.filter(entry => !entry.error);
            const errorEntries = parsedEntriesGlobal.filter(entry => entry.error);

            if (validEntries.length === 0 && errorEntries.length === 0) {
                outputDiv.innerHTML = `<p class="error-message">${T('statusNoDataToDisplay')}</p>`;
                window.lastAction = null;
                return;
            }

            // 1. Kumpulkan semua nilai unik untuk kunci yang dipilih
            const groups = {};
            validEntries.forEach(entry => {
                let groupKey = '';
                
                if (key === 'url') {
                    groupKey = entry.normalizedUrl;
                } else if (key === 'domain') {
                    groupKey = entry.domain;
                    if (groupKey === T('emptyPlaceholder')) groupKey = T('specialGroupKeyEmptyUrl');
                } else if (key === 'username') {
                    groupKey = entry.username;
                    if (groupKey === T('emptyPlaceholder')) groupKey = T('specialGroupKeyEmptyData');
                } else if (key === 'password') {
                    groupKey = entry.password;
                    if (groupKey === T('emptyPlaceholder')) groupKey = T('specialGroupKeyEmptyData');
                }

                // Normalisasi kunci untuk pengelompokan yang lebih baik
                if (groupKey === T('emptyPlaceholder')) {
                    groupKey = T('specialGroupKeyEmptyData');
                }

                if (!groups[groupKey]) {
                    groups[groupKey] = [];
                }
                groups[groupKey].push(entry);
            });

            // 2. Sortir grup berdasarkan jumlah entri
            const sortedGroupKeys = Object.keys(groups).sort((a, b) => {
                // Pindahkan grup error ke bawah
                const aIsSpecial = a.startsWith('Tidak Dapat Diparsing') || a.startsWith('Cannot Be Parsed');
                const bIsSpecial = b.startsWith('Tidak Dapat Diparsing') || b.startsWith('Cannot Be Parsed');
                if (aIsSpecial && !bIsSpecial) return 1;
                if (!aIsSpecial && bIsSpecial) return -1;

                // Urutkan berdasarkan jumlah (terbanyak di atas)
                return groups[b].length - groups[a].length;
            });

            // 3. Render Output
            outputDiv.innerHTML = ''; // Kosongkan output

            const keyName = T(`keyName${key.charAt(0).toUpperCase() + key.slice(1)}`);
            outputDiv.innerHTML += `<h2>${T('mainHeader')} - ${keyName}</h2>`;

            // Render grup
            sortedGroupKeys.forEach(groupKey => {
                const entries = groups[groupKey];
                const groupDiv = document.createElement('div');
                groupDiv.className = 'group';
                
                // Gunakan nama grup dan jumlah entri
                const headerText = `${groupKey} <span class="count">(${entries.length} ${T('entriesSuffix')})</span>`;
                groupDiv.innerHTML = `<h3>${headerText}</h3>`;
                
                const ul = document.createElement('ul');
                entries.forEach(entry => {
                    ul.appendChild(createListItem(entry));
                });
                groupDiv.appendChild(ul);
                outputDiv.appendChild(groupDiv);
            });

            // Tambahkan entri yang gagal diparsing (errorEntries)
            if (errorEntries.length > 0) {
                const errorGroupDiv = document.createElement('div');
                errorGroupDiv.className = 'group';
                const headerText = `${T('specialGroupKeyError')} <span class="count">(${errorEntries.length} ${T('entriesSuffix')})</span>`;
                errorGroupDiv.innerHTML = `<h3>${headerText}</h3>`;
                
                const ul = document.createElement('ul');
                errorEntries.forEach(entry => {
                    const li = createListItem(entry);
                    li.innerHTML += `<div class="error-message" style="margin-left: 10px;">${entry.error}</div>`;
                    ul.appendChild(li);
                });
                errorGroupDiv.appendChild(ul);
                outputDiv.appendChild(errorGroupDiv);
            }

            if (validEntries.length === 0 && errorEntries.length > 0) {
                outputDiv.innerHTML = `<h2>${T('mainHeader')} - ${keyName}</h2><p class="error-message">${T('statusNoDataParsed')}</p>` + outputDiv.innerHTML;
            }
            
            window.lastAction = 'group';
            window.lastGroupKey = key;
            
            // FITUR BARU: Tampilkan list URL Unik jika pengelompokan berdasarkan URL
            if (key === 'url') {
                const uniqueUrls = extractUniqueUrls(validEntries);
                displayUniqueUrlsOutput(uniqueUrls);
            } else {
                 uniqueUrlOutput.classList.remove('visible');
            }
        }

        // FUNGSI BARU: Ekstraksi URL Unik
        function extractUniqueUrls(parsedEntries) {
            const urls = new Set();
            parsedEntries.forEach(entry => {
                // Hanya ambil URL yang tidak dianggap placeholder (URL valid)
                if (entry.url && entry.url !== T('emptyPlaceholder') && entry.url !== T('errorEmptyUrl')) {
                    urls.add(entry.url);
                }
            });
            return Array.from(urls).sort();
        }

        // FUNGSI BARU: Menampilkan Output URL Unik
        function displayUniqueUrlsOutput(uniqueUrls) {
            const uniqueUrlOutput = document.getElementById('uniqueUrlOutput');
            const uniqueUrlTextarea = document.getElementById('uniqueUrlTextarea');
            const btnCopy = document.getElementById('btnCopyUniqueUrls');

            if (uniqueUrls.length > 0) {
                uniqueUrlTextarea.value = uniqueUrls.join('\n');
                uniqueUrlOutput.classList.add('visible');
                document.getElementById('uniqueUrlTitle').textContent = `${T('uniqueUrlTitle')} (${uniqueUrls.length})`;
                btnCopy.disabled = false;
                btnCopy.textContent = T('btnCopyUniqueUrls');

                // Pindahkan ke atas output, di bawah controls
                const controlsDiv = document.querySelector('.controls');
                controlsDiv.after(uniqueUrlOutput);

            } else {
                uniqueUrlTextarea.value = T('statusNoDataToDisplay');
                uniqueUrlOutput.classList.add('visible');
                document.getElementById('uniqueUrlTitle').textContent = T('uniqueUrlTitle');
                btnCopy.disabled = true;
                btnCopy.textContent = T('btnCopyUniqueUrls');
            }
        }

        // FUNGSI BARU: Menyalin URL Unik
        function copyUniqueUrls() {
            const textarea = document.getElementById('uniqueUrlTextarea');
            const button = document.getElementById('btnCopyUniqueUrls');
            
            if (textarea.value.trim() === '' || textarea.disabled) {
                button.textContent = T('statusNoDataToDisplay');
                setTimeout(() => button.textContent = T('btnCopyUniqueUrls'), 2000);
                return;
            }

            textarea.select();
            textarea.setSelectionRange(0, 99999); // For mobile devices

            try {
                navigator.clipboard.writeText(textarea.value).then(() => {
                    const originalText = button.textContent;
                    button.textContent = T('copySuccess');
                    button.style.backgroundColor = '#28a745';
                    setTimeout(() => {
                        button.textContent = originalText;
                        button.style.backgroundColor = ''; // Kembalikan ke default
                    }, 2000);
                }).catch(err => {
                    const originalText = button.textContent;
                    button.textContent = T('errorCopyFailed');
                    button.style.backgroundColor = '#e74c3c';
                    console.error('Failed to copy text: ', err);
                    setTimeout(() => {
                        button.textContent = originalText;
                        button.style.backgroundColor = '';
                    }, 3000);
                });
            } catch (err) {
                console.error('Clipboard API not supported or copy failed:', err);
                button.textContent = T('errorCopyFailed');
                button.style.backgroundColor = '#e74c3c';
                setTimeout(() => {
                    button.textContent = T('btnCopyUniqueUrls');
                    button.style.backgroundColor = '';
                }, 3000);
            }
        }
        
        // --- FUNGSI UTILITY LAINNYA (TIDAK BERUBAH) ---
        
        function createListItem(entry) {
            const li = document.createElement('li');
            li.setAttribute('data-original-line', entry.original);
            
            const originalLineSpan = document.createElement('span');
            originalLineSpan.className = 'original-line';
            originalLineSpan.textContent = entry.original;
            li.appendChild(originalLineSpan);

            const parsedInfoDiv = document.createElement('div');
            parsedInfoDiv.className = 'parsed-info hidden';
            
            let infoContent = '';
            infoContent += `**${T('parsedInfoLabelUrl')}:** ${entry.url}\n`;
            infoContent += `**${T('parsedInfoLabelUser')}:** ${entry.username}\n`;
            infoContent += `**${T('parsedInfoLabelPass')}:** ${entry.password}\n`;
            infoContent += `**${T('keyNameDomain')}:** ${entry.domain}\n`;
            if (entry.info !== T('emptyPlaceholder')) {
                infoContent += `**${T('parsedInfoLabelInfo')}:** ${entry.info}`;
            }
            parsedInfoDiv.textContent = infoContent.trim();
            
            li.appendChild(parsedInfoDiv);
            li.onclick = function() {
                parsedInfoDiv.classList.toggle('hidden');
            };
            
            return li;
        }

        function showAllParsed() {
            const input = document.getElementById('dataInput').value.trim();
            const outputDiv = document.getElementById('output');
            const uniqueUrlOutput = document.getElementById('uniqueUrlOutput');
            outputDiv.innerHTML = '';
            uniqueUrlOutput.classList.remove('visible');

            if (!input) {
                outputDiv.innerHTML = `<p class="error-message">${T('errorTextareaEmpty')}</p>`;
                window.lastAction = null;
                return;
            }

            const lines = input.split('\n').filter(line => line.trim() !== '');
            parsedEntriesGlobal = lines.map(line => parseLine(line));

            outputDiv.innerHTML = `<h2>${T('showAllTitle')} (${parsedEntriesGlobal.length} ${T('entriesSuffix')})</h2>`;
            const wrapperDiv = document.createElement('div');
            parsedEntriesGlobal.forEach(entry => {
                wrapperDiv.appendChild(createListItem(entry));
            });
            outputDiv.appendChild(wrapperDiv);

            window.lastAction = 'showAll';
            window.lastGroupKey = null;
        }

        function removePartialText() {
            const textarea = document.getElementById('dataInput');
            const textToRemove = document.getElementById('partialTextToRemove').value;
            
            if (!textToRemove) {
                alert(T('errorPartialTextEmpty'));
                return;
            }

            const lines = textarea.value.split('\n');
            const newLines = lines.map(line => line.includes(textToRemove) ? line.replace(new RegExp(escapeRegExp(textToRemove), 'g'), '') : line);
            textarea.value = newLines.join('\n');
            alert(`Teks "${textToRemove}" telah dihapus dari baris yang mengandungnya.`);
            // Reset tampilan hasil
            document.getElementById('output').innerHTML = `<p id="resultsPlaceholder">${T('resultsPlaceholder')}</p>`;
            document.getElementById('uniqueUrlOutput').classList.remove('visible');
            window.lastAction = null;
        }

        function removePredefinedText(textToRemove) {
            const textarea = document.getElementById('dataInput');
            const lines = textarea.value.split('\n');
            // Ganti secara global dan case-insensitive (misalnya untuk http/https)
            const newLines = lines.map(line => line.replace(new RegExp(escapeRegExp(textToRemove), 'gi'), ''));
            textarea.value = newLines.join('\n');
            alert(`Semua kemunculan '${textToRemove}' telah dihapus.`);
            // Reset tampilan hasil
            document.getElementById('output').innerHTML = `<p id="resultsPlaceholder">${T('resultsPlaceholder')}</p>`;
            document.getElementById('uniqueUrlOutput').classList.remove('visible');
            window.lastAction = null;
        }

        function escapeRegExp(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); // $& means the whole matched string
        }

        function removeDuplicateLinesFromTextarea() {
            const textarea = document.getElementById('dataInput');
            const lines = textarea.value.split('\n');
            
            if (lines.length === 0 || textarea.value.trim() === '') {
                alert(T('statusTextareaEmptyNoDuplicates'));
                return;
            }

            const originalLength = lines.filter(line => line.trim() !== '').length;
            const uniqueLines = Array.from(new Set(lines));
            
            textarea.value = uniqueLines.join('\n');
            const uniqueLength = uniqueLines.filter(line => line.trim() !== '').length;

            alert(T('statusDuplicatesRemoved', originalLength, uniqueLength));
            // Reset tampilan hasil
            document.getElementById('output').innerHTML = `<p id="resultsPlaceholder">${T('resultsPlaceholder')}</p>`;
            document.getElementById('uniqueUrlOutput').classList.remove('visible');
            window.lastAction = null;
        }

        function sortTextarea() {
            const textarea = document.getElementById('dataInput');
            const lines = textarea.value.split('\n');
            
            if (lines.length === 0 || textarea.value.trim() === '') {
                return;
            }

            // Pisahkan baris kosong dan baris berisi
            const emptyLines = lines.filter(line => line.trim() === '');
            const contentLines = lines.filter(line => line.trim() !== '');

            // Urutkan baris yang berisi
            contentLines.sort((a, b) => a.localeCompare(b));

            // Gabungkan kembali (baris kosong diletakkan di akhir)
            textarea.value = contentLines.join('\n') + (contentLines.length > 0 && emptyLines.length > 0 ? '\n' : '') + emptyLines.join('\n');
            
            // Reset tampilan hasil
            document.getElementById('output').innerHTML = `<p id="resultsPlaceholder">${T('resultsPlaceholder')}</p>`;
            document.getElementById('uniqueUrlOutput').classList.remove('visible');
            window.lastAction = null;
        }

    </script>
</body>
</html>