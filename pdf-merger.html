<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Penggabung PDF</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" />
    <style>
        :root {
            --bs-primary: royalblue;
            --bs-primary-rgb: 65, 105, 225;
        }

        body {
            background-color: #f0f2f5;
        }

        .drag-area {
            border-width: 3px !important;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .drag-area.highlight {
            border-color: var(--bs-primary) !important;
            background-color: rgba(var(--bs-primary-rgb), 0.1);
        }

        .drag-area .icon {
            font-size: 4rem;
            color: var(--bs-primary);
        }

        .file-input {
            display: none;
        }

        #fileList {
            max-height: 250px;
            overflow-y: auto;
        }

    </style>
</head>
<body class="bg-light-subtle">
    <div class="container my-5">
        <div class="card shadow-sm">
            <div class="card-body p-4 p-md-5 text-center">
                <h1 class="card-title text-primary fw-bold mb-4">Penggabung PDF Online</h1>
                <div class="drag-area border border-dashed rounded p-5 mb-4" id="dragArea">
                    <span class="icon"><i class="fa-solid fa-file-pdf"></i></span>
                    <p class="fs-5 text-muted my-2">Seret & jatuhkan file PDF di sini atau</p>
                    <button class="btn btn-primary upload-btn px-4">
                        <i class="fa-solid fa-upload me-2"></i>Pilih File
                    </button>
                    <input type="file" id="pdfFile" class="file-input" accept=".pdf" multiple>
                </div>

                <ul class="list-group text-start mb-4" id="fileList">
                </ul>

                <div class="d-grid gap-2 d-sm-flex justify-content-sm-center">
                    <button class="btn btn-primary btn-lg px-4" id="mergeBtn" disabled>
                        <i class="fa-solid fa-wand-magic-sparkles me-2"></i>Gabungkan PDF
                    </button>
                    <a id="downloadBtn" class="btn btn-success btn-lg px-4 d-none">
                        <i class="fa-solid fa-download me-2"></i>Unduh PDF Gabungan
                    </a>
                </div>

                <div class="alert mt-4 d-none" id="feedback" role="alert"></div>
            </div>
        </div>

        <div class="card shadow-sm mt-4">
            <div class="card-body p-4 p-md-5">
                <h2 class="card-title text-primary mb-3">Tentang Alat Penggabung PDF Ini</h2>
                <p class="card-text"><strong>Penggabung PDF Online</strong> ini adalah alat berbasis web yang memungkinkan Anda untuk menggabungkan beberapa file PDF menjadi satu dokumen tunggal dengan mudah dan cepat. Semua proses penggabungan dilakukan langsung di browser Anda, tanpa perlu mengunggah file ke server.</p>
                
                <h3 class="text-primary mt-4 mb-3">Bagaimana Cara Kerjanya?</h3>
                <p class="card-text">Alat ini menggunakan pustaka JavaScript yang kuat bernama <strong>pdf-lib</strong>. Ketika Anda memilih file PDF, browser Anda akan membaca file tersebut, dan pustaka ini akan memprosesnya untuk menyalin halaman dari setiap dokumen dan menyusunnya menjadi satu file PDF baru. Karena semua proses terjadi di sisi klien (di komputer Anda), file Anda tetap aman dan pribadi.</p>

                <h3 class="text-primary mt-4 mb-3">Keuntungan Utama</h3>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item"><i class="fa-solid fa-lock me-2 text-success"></i><strong>Privasi Terjamin:</strong> File Anda tidak pernah meninggalkan komputer Anda. Tidak ada data yang dikirim atau disimpan di server eksternal.</li>
                    <li class="list-group-item"><i class="fa-solid fa-bolt me-2 text-warning"></i><strong>Cepat dan Efisien:</strong> Proses penggabungan sangat cepat karena tidak ada waktu tunggu untuk unggah atau unduh dari server.</li>
                    <li class="list-group-item"><i class="fa-solid fa-infinity me-2 text-info"></i><strong>Gratis dan Tanpa Batas:</strong> Gunakan alat ini sepuasnya tanpa biaya atau batasan jumlah file.</li>
                </ul>

                <div class="alert alert-warning mt-4" role="alert">
                    <h4 class="alert-heading"><i class="fa-solid fa-triangle-exclamation me-2"></i>Peringatan</h4>
                    <p>Meskipun alat ini efisien, menggabungkan file PDF yang sangat besar atau dalam jumlah yang sangat banyak dapat membebani memori browser Anda dan mungkin menyebabkan kinerja lambat atau crash pada browser. Disarankan untuk me-refresh halaman jika Anda mengalami masalah.</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <script>
        const { PDFDocument } = PDFLib;

        const dragArea = document.getElementById('dragArea');
        const fileInput = document.getElementById('pdfFile');
        const fileList = document.getElementById('fileList');
        const mergeBtn = document.getElementById('mergeBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const feedbackDiv = document.getElementById('feedback');

        let uploadedFiles = []; // Menyimpan objek File dari PDF yang diunggah

        // Fungsi untuk menampilkan feedback
        function showFeedback(message, type) {
            feedbackDiv.textContent = message;
            feedbackDiv.className = `alert alert-${type} d-block`; // Reset dan set kelas
        }

        // Fungsi untuk menyembunyikan feedback
        function hideFeedback() {
            feedbackDiv.className = 'alert d-none';
        }

        // Fungsi untuk memperbarui daftar file yang ditampilkan
        function updateFileList() {
            fileList.innerHTML = ''; // Kosongkan daftar yang ada
            if (uploadedFiles.length === 0) {
                fileList.classList.add('d-none');
                mergeBtn.disabled = true;
                downloadBtn.classList.add('d-none');
                return;
            }

            fileList.classList.remove('d-none');
            uploadedFiles.forEach((file, index) => {
                const listItem = document.createElement('div');
                listItem.className = 'list-group-item d-flex justify-content-between align-items-center';
                listItem.innerHTML = `
                    <span class="text-truncate me-3">${file.name}</span>
                    <button class="btn btn-sm btn-outline-danger remove-btn" data-index="${index}">&times;</button>
                `;
                fileList.appendChild(listItem);
            });

            // Aktifkan tombol gabung jika ada setidaknya 2 file
            mergeBtn.disabled = uploadedFiles.length < 2;
        }

        // Event listener untuk tombol "Pilih File"
        dragArea.querySelector('.upload-btn').addEventListener('click', () => {
            fileInput.click();
        });

        // Event listener untuk input file
        fileInput.addEventListener('change', (event) => {
            hideFeedback();
            const files = Array.from(event.target.files);
            
            // Filter hanya file PDF
            const pdfs = files.filter(file => file.type === 'application/pdf');

            if (pdfs.length === 0) {
                showFeedback('Hanya file PDF yang diizinkan.', 'danger');
                return;
            }

            // Tambahkan file yang baru diunggah ke daftar yang sudah ada, menghindari duplikat berdasarkan nama & ukuran
            pdfs.forEach(newFile => {
                const exists = uploadedFiles.some(existingFile => 
                    existingFile.name === newFile.name && existingFile.size === newFile.size
                );
                if (!exists) {
                    uploadedFiles.push(newFile);
                } else {
                    showFeedback(`File "${newFile.name}" sudah ada dalam daftar.`, 'warning');
                }
            });
            updateFileList();
        });

        // Event listener untuk area drag-and-drop
        dragArea.addEventListener('dragover', (event) => {
            event.preventDefault();
            dragArea.classList.add('highlight');
            showFeedback('Lepaskan file PDF Anda di sini.', 'info');
        });

        dragArea.addEventListener('dragleave', () => {
            dragArea.classList.remove('highlight');
            hideFeedback();
        });

        dragArea.addEventListener('drop', (event) => {
            event.preventDefault();
            dragArea.classList.remove('highlight');
            hideFeedback();

            const files = Array.from(event.dataTransfer.files);
            const pdfs = files.filter(file => file.type === 'application/pdf');

            if (pdfs.length === 0) {
                showFeedback('Hanya file PDF yang diizinkan.', 'danger');
                return;
            }

            pdfs.forEach(newFile => {
                const exists = uploadedFiles.some(existingFile => 
                    existingFile.name === newFile.name && existingFile.size === newFile.size
                );
                if (!exists) {
                    uploadedFiles.push(newFile);
                } else {
                    showFeedback(`File "${newFile.name}" sudah ada dalam daftar.`, 'warning');
                }
            });
            updateFileList();
        });

        // Event listener untuk menghapus file dari daftar
        fileList.addEventListener('click', (event) => {
            if (event.target.classList.contains('remove-btn')) {
                const indexToRemove = parseInt(event.target.dataset.index);
                uploadedFiles.splice(indexToRemove, 1);
                updateFileList();
                hideFeedback();
            }
        });

        // Event listener untuk tombol "Gabungkan PDF"
        mergeBtn.addEventListener('click', async () => {
            if (uploadedFiles.length < 2) {
                showFeedback('Pilih setidaknya 2 file PDF untuk digabungkan.', 'danger');
                return;
            }

            showFeedback('Menggabungkan PDF, mohon tunggu...', 'info');
            mergeBtn.disabled = true;
            downloadBtn.classList.add('d-none');

            try {
                const mergedPdf = await PDFDocument.create();

                for (const file of uploadedFiles) {
                    const arrayBuffer = await file.arrayBuffer();
                    const pdf = await PDFDocument.load(arrayBuffer);
                    const copiedPages = await mergedPdf.copyPages(pdf, pdf.getPageIndices());
                    copiedPages.forEach((page) => mergedPdf.addPage(page));
                }

                const mergedPdfBytes = await mergedPdf.save();
                const blob = new Blob([mergedPdfBytes], { type: 'application/pdf' });
                const url = URL.createObjectURL(blob);

                downloadBtn.href = url;
                downloadBtn.download = 'pdf_gabungan.pdf';
                downloadBtn.classList.remove('d-none');
                showFeedback('PDF berhasil digabungkan!', 'success');
            } catch (error) {
                console.error('Error saat menggabungkan PDF:', error);
                showFeedback(`Terjadi kesalahan saat menggabungkan PDF: ${error.message}`, 'danger');
            } finally {
                mergeBtn.disabled = false;
            }
        });

        // Inisialisasi tampilan daftar file
        updateFileList();
    </script>
</body>
</html>